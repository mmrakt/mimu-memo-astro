---
import React from 'react'

import { MEDIA_LIST_DISPLAY, QIITA_FEED_URL, ZENN_FEED_URL } from '../../config'
import { convertMediaNameToSlug, fetchFeed } from '../../utils'
import type { Frontmatter, Media, MediaDisplay } from '../../types'
import { getCollection } from 'astro:content'
import LoadingSpinner from '../elements/LoadingSpinner.astro'

const ownedMd = await getCollection('owned')
const qiitaFeed = await fetchFeed(QIITA_FEED_URL)
const zennFeed = await fetchFeed(ZENN_FEED_URL)

const getCountByMedia = (media: MediaDisplay) => {
  if (media === 'mimu-memo') {
    return ownedMd.length
  } else if (media === 'Qiita') {
    return qiitaFeed.items.length
  } else if (media === 'Zenn') {
    return zennFeed.items.length
  }
  return 0
}
---

<div class="mediaList">
  <h3 class="mediaList__header">Media</h3>
  <div class="mediaList__list">
    {
      MEDIA_LIST_DISPLAY.map((media) => (
        <>
          {!media ? (
            <LoadingSpinner />
          ) : (
            <a
              href={`/${convertMediaNameToSlug(media)}/page/1`}
              class="mediaList__itemLink"
            >
              <span class="mediaList__itemText">
                #{media}({getCountByMedia(media)})
              </span>
            </a>
          )}
        </>
      ))
    }
  </div>
</div>

<style lang="scss">
  @use '../../styles/utils' as utils;
  @use '../../styles/variables' as vars;

  .mediaList {
    margin-top: 16px;
    &__header {
      font-size: 20px;
      font-weight: bolder;
    }
    &__list {
      margin-top: 8px;
    }

    &__itemLink {
      display: block;
      width: fit-content;
      padding: 4px;
    }
    &__itemText {
      margin-top: 8px;
      font-weight: 500;

      @extend %link;
    }
  }
</style>
