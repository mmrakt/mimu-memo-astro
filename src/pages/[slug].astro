---
import { CollectionEntry, getCollection, getEntry } from 'astro:content'
import type { Frontmatter, PaginatedPost } from '../types'
import { extractSlugFromMd } from '../utils'
import BaseLayout from '../components/layouts/BaseLayout.astro'
import Container from '../features/postDetail/Container.astro'
import Head from '../components/layouts/Head'

export async function getStaticPaths() {
  const collection = await getCollection('owned')

  let paths = []
  for (let i = 0; i < collection.length; i++) {
    let nextUrl = '',
      nextTitle = '',
      prevUrl = '',
      prevTitle = ''

    if (i !== collection.length - 1) {
      nextUrl = collection[i + 1].slug
      nextTitle = collection[i + 1].data.title
    }
    if (i !== 0) {
      prevUrl = collection[i - 1].slug
      prevTitle = collection[i - 1].data.title
    }

    paths.push({
      params: {
        slug: collection[i].slug,
      },
      props: {
        entry: collection[i],
        next: {
          url: nextUrl,
          title: nextTitle,
        },
        prev: {
          url: prevUrl,
          title: prevTitle,
        },
      },
    })
  }
  return paths
}
type Props = PaginatedPost

const post = Astro.props as Props
const { Content } = await post.entry.render()
---

<html lang="ja">
  <Head
    pageTitle={post.entry.data.title}
    pagePath={post.entry.slug}
    pageType="article"
  />
  <BaseLayout hasSideBar={true}>
    <Container post={post}>
      <Content />
    </Container>
  </BaseLayout>
</html>
