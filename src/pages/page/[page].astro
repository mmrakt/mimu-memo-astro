---
import type { Page, PaginateFunction } from 'astro'
import BaseLayout from '../../layouts/BaseLayout.astro'
import PostListLayout from '../../layouts/PostListLayout.astro'
import ChevronLeft from '../../components/common/ChevronLeft.tsx'
import {
  makeQiitaPost,
  makeZennPost,
  extractSlugFromMd,
  sortPostsByPubDate,
} from '../../utils'
import type { Frontmatter } from '../../types/index.ts'

export async function getStaticPaths({
  paginate,
}: {
  paginate: PaginateFunction
}) {
  const ownedMd = await Astro.glob<Frontmatter>('../../content/owned/*.md'),
    qiitaPosts = await makeQiitaPost(),
    zennPosts = await makeZennPost()
  const ownedPosts: Frontmatter[] = ownedMd.map((post) => {
    return {
      pubDate: post.frontmatter.pubDate,
      title: post.frontmatter.title,
      link: extractSlugFromMd(post),
      media: 'owned',
    }
  })

  const posts = sortPostsByPubDate([...ownedPosts, ...qiitaPosts, ...zennPosts])

  return paginate(posts, { pageSize: 10 })
}
type Props = {
  page: Page<Frontmatter>
}
const { page } = Astro.props
---

<html lang="ja">
  <BaseLayout pageUrl="">
    <PostListLayout page={page} />
  </BaseLayout>
</html>
